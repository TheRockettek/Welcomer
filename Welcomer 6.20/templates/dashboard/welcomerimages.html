{% include "partials/_header.html" %}
<div class="container-scroller">
  {% include "partials/_navbar.html" %}
  <div class="container-fluid page-body-wrapper">
    {% include "partials/_sidebar.html" %}
    <div class="main-panel">
      <div class="content-wrapper">
        <div class="card">
            <div class="card-body">
                <div class="container-fluid bg-primary py-2 mb-4">
                    <p class="mb-0 text-white">Welcomer Images</p>
                </div>

                <div class="row border-bottom my-4">
                    <div class="col col-6">
                        <m3>Enable Welcomer Images</m3>
                    </div>
                    <div class="col col-6 text-right">
                        <label class="switch"><input enabled id="enableimages" type="checkbox" {{ "checked" if config['enableimages'] else "" }}><span class="slider round"></span></label>
                    </div>
                    <div class="col col-12">
                        <p class="text-muted">By enabling welcomer images, the bot will attempt to create images for ther based off of the current settings. Please note enabling embeds may be required for higher resolution images and animated ones due to discord 8Mb file limit</p>
                    </div>
                </div>

                <div class="row border-bottom my-4">
                    <div class="col col-6">
                        <m3>Text Colour</m3>
                    </div>
                    <div class="col col-6 text-right">
                        <input type='text' id="textcolour" class="color-picker" value="#{{ config['textcolour'].replace("RGBA|", "").replace("RGB|", "") }}" />
                    </div>
                    <div class="col col-12">
                        <p class="text-muted">Colour of the main text that is displayed</p>
                    </div>
                </div>

                <div class="row border-bottom my-4">
                    <div class="col col-6">
                        <m3>Text Outline Colour</m3>
                    </div>
                    <div class="col col-6 text-right">
                        <input type='text' id="textbordercolour" class="color-picker" value="#{{ config['textbordercolour'].replace("RGBA|", "").replace("RGB|", "") }}" />
                    </div>
                    <div class="col col-12">
                        <p class="text-muted">Outline Colour for the main text to allow for more readability</p>
                    </div>
                </div>
                
                <div class="row border-bottom my-4">
                    <div class="col col-6">
                        <m3>Profile Outline Colour</m3>
                    </div>
                    <div class="col col-6 text-right">
                        <input type='text' id="profileoutlinecolour" class="color-picker" value="#{{ config['profileoutlinecolour'].replace("RGBA|", "").replace("RGB|", "") }}" />
                    </div>
                    <div class="col col-12">
                        <p class="text-muted">Colour that will be used as an outline for the profile picture image. If the user has a transparent background, the transparency will be also filled by this colour if applicable</p>
                    </div>
                </div>

                <div class="row border-bottom my-4">
                    <div class="col col-6">
                        <div class="badge badge-outline-primary badge-pill">New Feature</div>
                        <m3>Image Border</m3>
                    </div>
                    <div class="col col-6 text-right align-middle">
                        <label class="switch"><input enabled id="enableimageborder" type="checkbox" {{ "checked" if config['enableimageborder'] else "" }}><span class="slider round"></span></label>
                        <input type='text' id="imagebordercolour" class="color-picker" value="#{{ config['imagebordercolour'].replace("RGBA|", "").replace("RGB|","") }}" />
                    </div>
                    <div class="col col-12">
                        <p class="text-muted">If enabled, a coloured border will be applied to every welcome image</p>
                    </div>
                </div>

                <div class="row border-bottom my-4">
                    <div class="col col-6">
                        <div class="badge badge-outline-primary badge-pill">New Feature</div>
                        <m3>Text Align</m3>
                    </div>
                    <div class="col col-6 text-right">
                        <select class="form-control border-primary" id="textalign">
                            <option {{ "selected" if config['textalign'] in [0, "left"] else "" }}>left</option>
                            <option {{ "selected" if config['textalign'] in [1, "center"] else "" }}>center</option>
                            <option {{ "selected" if config['textalign'] in [2, "right"] else "" }}>right</option>
                        </select>
                    </div>
                    <div class="col col-12">
                        <p class="text-muted">Aligment of text on welcomer image. Please note some image themes may force a certain alignment</p>
                    </div>
                </div>

                <div class="row border-bottom my-4">
                    <div class="col col-6">
                        <div class="badge badge-outline-primary badge-pill">New Feature</div>
                        <m3>Image Theme</m3>
                    </div>
                    <div class="col col-6 text-right">
                        <select class="form-control border-primary" id="texttheme">
                            <option {{ "selected" if config['texttheme'] == 0 else "" }} value="0">Legacy</option>
                            <option {{ "selected" if config['texttheme'] == 1 else "" }} value="1">Vertical</option>
                            <option {{ "selected" if config['texttheme'] == 2 else "" }} value="2">Badge</option>
                            <option {{ "selected" if config['texttheme'] == 3 else "" }} value="3">Shadowed</option>
                            <option {{ "selected" if config['texttheme'] == 4 else "" }} value="4">Widget</option>
                        </select>
                    </div>
                    <div class="col col-12">
                        <p class="text-muted">Themes allow for you to customise the overall format of your welcome images. Find the image previews <a href="/backgrounds">here</a>.</p>
                    </div>
                </div>

                <div class="row border-bottom my-4">
                    <div class="col col-6">
                        <div class="badge badge-outline-primary badge-pill">New Feature</div>
                        <m3>Profile Shape</m3>
                    </div>
                    <div class="col col-6 text-right">
                        <select class="form-control border-primary" id="profilebordertype">
                            <option {{ "selected" if config['profilebordertype'] == 4 else "" }} value="4">No profile picture</option>
                            <option {{ "selected" if config['profilebordertype'] == 0 else "" }} value="0">Circular</option>
                            <option {{ "selected" if config['profilebordertype'] == 3 else "" }} value="3">No Border (Circular Image)</option>
                            <option {{ "selected" if config['profilebordertype'] == 2 else "" }} value="2">Square</option>
                            <option {{ "selected" if config['profilebordertype'] == 1 else "" }} value="1">No Border (Square Image)</option>
                        </select>
                    </div>
                    <div class="col col-12">
                        <p class="text-muted">Changing the profile shapes allow you to toggle between circular and square profile pictures and having a border or removing the border</p>
                    </div>
                </div>

                <div class="row border-bottom my-4">
                    <div class="col col-6">
                        <m3>Image Message</m3>
                    </div>
                    <div class="col col-6 text-right">
                        <textarea style="height: 200px;" id="message" type="text" class="form-control">{{ config['message'] }}</textarea>
                    </div>
                    <div class="col col-12">
                        <p class="text-muted">Allow you to customise the message that are used. New lines represent a different line in the welcome message and also support the use of formatting which you can find <a href="/formatting">here</a></p>
                    </div>
                </div>

                <div class="container-fluid bg-primary py-2 mb-4 mt-5">
                    <p class="mb-0 text-white">Welcomer Image Backgrounds</p>
                </div>

                <div class="row border-bottom my-4">
                    <div class="col col-6">
                        <m3>Welcomer Background</m3>
                    </div>
                    <div class="col col-6 text-right">
                        <select class="form-control border-primary" id="background">
                            <option {{ "selected" if config['background'] == ("custom_" + guild['id']) else "" }} value="custom_{{ guild['id'] }}">Custom Background</option>
                            <option {{ "selected" if config['background'] == ("default") else "" }} value="default">default</option>
                            <option disabled>-----------------</option>
                            {% for background in list(sorted(backgrounds)) %}
                                <option {{ "selected" if config['background'] == background else "" }} value="{{ background }}">{{ background }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col col-12">
                        <p class="text-muted">Change the backgrounds to your liking. If you are using a custom background, make sure custom background is selected! Find previews of all backgrounds <a href="/backgrounds">here</a></p>
                    </div>
                </div>
    
                <div class="row border-bottom my-4">
                    <div class="col col-6">
                        <m3>Custom Background</m3>
                    </div>
                    <div class="col col-6 text-right">
                        <input id="custombackground" type="file" class="dropify" />
                    </div>
                    <div class="col col-12">
                        <p class="text-muted">Upload a new file here to update your current welcomer background</p>
                        {% if len(config['donations']) == 0 %}
                            <div class="alert alert-fill my-3" role="info"><i class="mdi mdi-do-not-disturb"></i> This feature is only avaliable for donators of the bot either through Welcomer Pro or a one time payment. Find out more <a href="/donate">here</a>. </div>
                        {% endif %}
                    </div>
                </div>
    
                <div class="row border-bottom my-4">
                        <div class="col col-6">
                            <m3>Current Custom Background</m3>
                        </div>
                        <div class="col col-12">
                            <img class="rounded mx-auto d-block img-fluid img-thumbnail" src="/api/getbackground/custom_{{ guild['id'] }}.png?_={{ ctime() }}">
                        </div>
                    </div>
                <div class="wrapper">
                    <a onclick="applychanges()" class="btn btn-outline-primary btn-block">Save changes</a>
                </div>

                <script>
                function applychanges() {
                    var formData = new FormData();
                    formData.set("enableimages", document.getElementById("enableimages").checked);
                    formData.set("enableimageborder", document.getElementById("enableimageborder").checked);
                    formData.set("message", document.getElementById("message").value);
                    formData.set("textalign", document.getElementById("textalign").value);
                    formData.set("texttheme", document.getElementById("texttheme").value);
                    formData.set("background", document.getElementById("background").value);
                    formData.set("textcolour", document.getElementById("textcolour").value);
                    formData.set("textbordercolour", document.getElementById("textbordercolour").value);
                    formData.set("imagebordercolour", document.getElementById("imagebordercolour").value);
                    formData.set("profilebordertype", document.getElementById("profilebordertype").value);
                    formData.set("profileoutlinecolour", document.getElementById("profileoutlinecolour").value);

                    if ($('#custombackground').get(0).files.length > 0) {
                        formData.set("file", $('#custombackground').get(0).files[0], $('#custombackground').get(0).files[0].name);
                    };

                    $.ajax({method: "POST", data: formData, dataType: "json", processData: false, contentType: false,
                        success: function(data) {if (data.success == true) {$.toast({heading: 'Your settings have been applied', loaderBg: '#7289da', bgColor: '#5767a0', position: 'top-right', hideAfter: 5000, showHideTransition: 'fade', icon: 'success'})} else {$.toast({heading: 'Encountered an error whilst applying changes', loaderBg: '#7289da', bgColor: '#5767a0', text: data.error, position: 'top-right', hideAfter: 5000, showHideTransition: 'fade', icon: 'error'})}},
                        error: function() {$.toast({heading: 'An error had occured while applying settings', loaderBg: '#7289da', bgColor: '#5767a0', position: 'top-right', hideAfter: 5000, showHideTransition: 'fade', icon: 'error'})}
                    });
                };
                </script>
            </div>
        </div>
        {% include "partials/_footer.html" %}
    </div>
  </div>
</div>
{% include "partials/_ender.html" %}